<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html  lang='zh-CN'>
	<head>
		<title>也来写一写后缀数组的倍增法构造</title>
		<meta charset="utf-8">
		<META NAME="Description" CONTENT="后缀数组 倍增算法">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://xie-yu.github.com/xie-yu.xml" />
		<link rel="stylesheet" type="text/css" href="../../css/global.css" />
		<link rel="stylesheet" type="text/css" href="../../css/simple-highlight/simple-highlight.css" />
		<style type="text/css">
			#code { font-size: 11px; }
		</style>
		<script type="text/javascript" src="../../js/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="../../js/global.js"></script>
		<script type="text/javascript" src="../../js/simple-highlight/simple-highlight.js"></script>
		<script type="text/javascript" src="http://js.tongji.linezing.com/2940294/tongji.js"></script>
	</head>
	<body>
		<div id="main">
			<div id="header">
				<div id="logo"><img src='../../img/logo.gif'></img>ie-Yu的博客</div>
				<div id="index">
					<span><a href="../../index.html">首页</a></span>
					<span><a href="../index.html"  class="index-sel">博客</a></span>
					<span><a href="../../about.html">关于</a></span>
				</div>
				<div id="self-intro">
					<div id="avatar">
						<img src="../../img/me.gif"></img>
					</div>
					<div id="intro-text">
						我是谢彧，在这里写博客<br />
						记录下学习的收获<br />
						实践有趣的想法<br />
						你可以通过<a href='http://feeds.feedburner.com/xie-yu' target="_blank"> RSS </a>获得本博客的更新<br />
						我的邮箱是：xieofyu at gmail.com
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div id="content">
				<div class="blog-view">
					<div class="blog-title-wrap">
						<div class="blog-title">
							<h1>也来写一写后缀数组的倍增法构造</h1>
						</div>
						<div class="blog-title-info">
							<span class="date">2012-9-25</span>
						</div>
					</div>
					<div class="blog-content-view">
						<p>
							整整这一周都在折腾后缀数组。大概是前天，终于实现了倍增法构造后缀数组的算法，之后又花了几天时间，才把height数组<!--
							-->正确的求出来。不用说，我自脑力不胜，但折腾这么长的时间，不能说和网络上各种不甚明白的后缀数组文章没有关系。网上<!--
							-->后缀数组的文章一大把，但除了2篇或3篇能看到作者自己的思考的文章外，其他无外乎就是摘抄IOI的那2篇论文。这些文章，<!--
							-->因为没有了原论文的数学公式格式，加之又不愿意整个论文copy下来，东拼西凑，变得很难阅读。当然最本质的是，所谓“模板”<!--
							-->的那个算法，很厉害很飘逸，要读懂的确不容易。
						</p>
						<p>
							发了这么一顿牢骚，其实本文也不打算“明明白白”地讲解一下怎么用倍增法构造后缀数组。最好的阅读材料，其实就是IOI的论文，我<!--
							-->看的是<a href="https://github.com/xie-yu/xie-yu.github.com/blob/master/resource/suffix_array.pdf" target="_blank">这篇</a>。<!--
							-->这篇文章没有实现代码，但看完论文，大概的伪代码是容易写出来的，稍微细心一点，写一段同样飘逸的代码也就不难了。<!--
							-->作为牢骚的延续，我打算贴一贴我的代码，反正，不就是比谁写的更风骚么。跟“模板”的实现不同的是，我没有将字符串末尾<!--
							-->加一个特殊字符，所以后续代码，特别是求height数组，会有些不一样。可惜，这时候发现博客设计不大好，不能完全按照<!--
							-->“模板”的风骚风格来写，只能这样是下面这个样子了。
						</p>
						<p>
							看代码。
						</p>
						<p><pre id="code">
 int  sa_1p[N],sa_2p[N],rank[N],rank_cpy[N];
 int  cnt[N + 1],acc[N + 1],k,n;
 int  h[N],height[N];
 char str[N + 1];

 int equal(int a,int b)
 {
   if(rank[a] == rank[b]
      &&a+k&lt;n&&b+k&lt;n
	 &&rank[a + k]==rank[b+k])
     return 0;
   return 1;
 }

 void doubling()
 {
   int i, j;
   /* initiate sa_2p, rankings and k */
   for(i=0;i&lt;n;i++)
	  cnt[str[i]-'a'+1]=1;
   for(i=1;i&lt;=27;i++)
	  cnt[i]+=cnt[i-1];
   for(i=0;i&lt;n;i++)
	  sa_2p[cnt[str[i]-'a']+acc[str[i]-'a'+1]++]=i;
   for(i=0;i&lt;n;i++)
	  rank[i]=cnt[str[i]-'a'+1];
   /* doubling */
   for(k=1;rank[sa_2p[n-1]]&lt;n;k+=k){
     /* 1st pass of radix sort */
     memset(cnt,0,sizeof(cnt));
     memset(acc,0,sizeof(acc));
     cnt[0]=k;
     for(i=n-k,j=0;i&lt;n;i++)
	    sa_1p[j++]=i;
     for(i=0;i&lt;n-k;i++)
	    cnt[rank[i+k]]++;
     for(i=1;i&lt;n;i++)
	    cnt[i]+=cnt[i-1];
     for(i=0;i&lt;n-k;i++)
	    sa_1p[cnt[rank[i+k]-1]+acc[rank[i+k]]++]=i;
     /* 2nd pass of radix sort */
     memset(cnt,0,sizeof(cnt));
     memset(acc,0,sizeof(acc));
     for(i=0;i&lt;n;i++)
	    cnt[rank[sa_1p[i]]]++;
     for(i=1;i&lt;n;i++)
	    cnt[i]+=cnt[i - 1];
     for(i=0;i&lt;n;i++)
       sa_2p[cnt[rank[sa_1p[i]]-1]+acc[rank[sa_1p[i]]]++]
		     =sa_1p[i];
     /* update rank and k */
     rank_cpy[sa_2p[0]]=1;
     for(i=1;i&lt;n;i++)
       rank_cpy[sa_2p[i]]=
	      equal(sa_2p[i],sa_2p[i-1])+rank_cpy[sa_2p[i-1]];
     memcpy(rank,rank_cpy,sizeof(rank_cpy));
   }
 }

 int dis(int a, int b)
 {
   int i = a, j = b;
   while(i &lt; n && j &lt; n && str[i] == str[j]) {
     i++;
     j++;
   }
   return i - a;
 }

 void cal_height()
 {
   int i;
   /* calculate h[0] first */
   if(rank[0]==1)
	  h[0]=0; /* no pre-substring */
   else
	  h[0]=dis(0,sa_2p[rank[0]-1-1]);
   /* iterations for each h[i] */
   for(i = 1; i &lt; n; i++) {
     if(rank[i]==1)
       h[i]=0; /* no pre-substring */
     else {
       if(h[i-1]&lt;2)
	    h[i]=dis(i,sa_2p[rank[i]-1-1]);
       else
         h[i]=h[i-1]-1+
           dis(i+h[i-1]-1,sa_2p[rank[i]-2]+h[i-1]-1);
     }
   }
   /* finally calculate height */
   for(i = 1;i&lt;n;i++)height[i]=h[sa_2p[i]];
 }
 
 int main()
 {
   int i;
   scanf("%s", str);
   n = strlen(str);
   doubling();
   for(i=0;i&lt;n;i++)
     printf("%s\n",str+sa_2p[i]);
   cal_height();
   for(i=0;i&lt;n-1;i++)
     printf("%d(%s:%s)\n",
	        height[i+1],str+sa_2p[i],str+sa_2p[i+1]);
   return 0;
 }

						</pre></p>
						<p>
							<div id="seecomments"><a href="#disqus_thread" onclick="seeComments(this)">点击添加评论<img src='../../img/comment.gif' /></a></div>
							<div id="disqus_thread"></div>
						</p>
						<div class="link-to">
							<div class="link-toright">
								<a href="./old-style-c-concerning-floating-point-representation.html">一段Old Style C代码：不带类型声明的形参 »</a>
							</div>
						</div>
						<div class="clear"></div>
					</div>
				</div>
			</div>
			<div id="push">
				
			</div>
		</div>
		<div id="footer">
			<div id="footer-note">
				Xie-Yu博客· github/xie-yu · design by 谢彧
			</div>
		</div>
	</body>
	<script>
		$("#code").simpleHighlight();
		$("#code").css("font-size", "9px");
	</script>
</html>
